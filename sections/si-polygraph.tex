% si-polygraph.tex

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\polysi: Polygraph based Characterization of SI}
	\begin{center}
		{\it polygraph} based characterization of SI

		\vspace{0.30cm}
		\fig{width = 0.90\textwidth}{figs/polysi-checker-polygraph}
		\vspace{0.30cm}

	  \pause
		We first review the {\it dependency graph} based characterization of SI~\ncite{AnalysingSI:JACM2018}.
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
  \begin{center}
		\only<4>{
			$T_{0} \rel{\WR} T_{A} \land T_{0} \rel{\WW} T_{B}
			  \implies T_{A} \rel{\RW} T_{B}$
		}
		\only<5>{
			$T_{0} \rel{\WR} T_{B} \land T_{0} \rel{\WW} T_{A}
			  \implies T_{A} \rel{\RW} T_{A}$
		}
		\only<7->{
			\red{$\boxed{\text{\it Suppose that}\;\; T_{A} \rel{\WW} T_{B}}$}
		}

		\vspace{0.20cm}
		{\input{tikz/banking-lost-update-depgraph-tikz}}
		\vspace{0.20cm}

		\only<2>{
			$\WR$: ``write-read'' dependency capturing the ``read-from'' relation
		}
		\only<3>{
			$\WW$: ``write-write'' dependency capturing the version order on $\acct$
		}
		\only<4-5>{
			$\RW$: ``read-write'' dependency capturing the overwritten relation
		}
		\only<6>{
			The cycle $T_{A} \rel{\RW} T_{B} \rel{\RW} T_{A}$ is \blue{allowed} by SI.
		}
		\only<7>{
			undesired cycle: $T_{A} \rel{\WW} T_{B} \rel{\RW} T_{A}$
		}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
	\begin{center}
		\uncover<2->{
			\red{$\boxed{\text{\it Suppose that}\;\; T_{B} \rel{\WW} T_{A}}$}
		}

		\vspace{0.20cm}
		{\input{tikz/banking-lost-update-depgraph-ww-tbta-tikz}}
		\vspace{0.20cm}

		\uncover<4>{
			undesired cycle: $T_{B} \rel{\WW} T_{A} \rel{\RW} T_{B}$
		}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
  \begin{center}
		We have considered both bases $T_{A} \rel{\WW} T_{B}$
		and $T_{B} \rel{\WW} T_{A}$.

		\vspace{0.20cm}
		\fig{width = 0.65\textwidth}{figs/banking-lost-update-wr}
		\vspace{0.20cm}

		Either case leads to an undesired cycle. \\[2pt]
		Therefore, it does not satisfy SI.
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
  \begin{theorem}[Theorem 4.1 of~\ncite{AnalysingSI:JACM2018}]
		Informally, a history satisfies SI if only if \\[3pt]
		\red{there exists} a dependency graph for it that contains \\[3pt]
		only cycles (if any) with \blue{at least two adjacent $\RW$} edges.
	\end{theorem}

	\vspace{0.50cm}
	\begin{center}
		\fbox{Undesired cycles: do not contain adjacent $\RW$ edges}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
	\begin{columns}
		\column{0.50\textwidth}
			{\fig{width = 1.00\textwidth}{figs/banking-lost-update-depgraph}}
		\column{0.50\textwidth}
			{\fig{width = 1.00\textwidth}{figs/banking-lost-update-depgraph}}
	\end{columns}

	\vspace{0.30cm}
	\begin{center}
		Every possible dependency graph {\it contains}
		an undesired \raisebox{-1.0ex}{\includegraphics[scale = 0.50]{figs/ww-rw-cycle}} cycle.
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
  \begin{theorem}[Theorem 4.1 of~\ncite{AnalysingSI:JACM2018}]
		For a history \emph{$\H = (\T, \SO)$},
		\vspace{-0.30cm}
		\begin{align*}
			\H \models \si & \iff \H \models \intaxiom \;\land \\
				&\teal{\exists}\; \WR, \WW, \RW.\; \G = (\H, \WR, \WW, \RW) \;\land \\
				&\quad (\blue{((\SO_{\G} \cup \WR_{\G} \cup \WW_{\G}) \comp \RW_{\G}?)} \text{\it\; is acyclic}).
		\end{align*}
  \end{theorem}

	\begin{center}
		\resizebox{0.60\textwidth}{!}{\input{tikz/banking-lost-update-depgraph-theorem-tikz.tex}}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Dependency Graph based Characterization of SI}
  \begin{center}
		\red{$\mathcal{Q}:$ How to capture all {possible} $\WW$ dependencies?}

		\vspace{0.50cm}
		\begin{columns}
			\column{0.50\textwidth}
				\fig{width = 1.00\textwidth}{figs/banking-lost-update-depgraph}
			\column{0.50\textwidth}
				\fig{width = 1.00\textwidth}{figs/banking-lost-update-depgraph-ww-tbta}
		\end{columns}

		% \pause
		\vspace{0.80cm}
		\blue{$\mathcal{A}:$ represent all possible dependency graphs in a single polygraph}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{Polygraphs: A Family of Dependency Graphs}
	\begin{center}
		Consider the two cases of $\WW$ dependencies between $T_{A}$ and $T_{B}$.
	\end{center}

	\vspace{-0.20cm}
	\begin{columns}[c]
		\column{0.50\textwidth}
			\fig{width = 0.80\textwidth}{figs/banking-lost-update-depgraph}
		\column{0.50\textwidth}
			\fig{width = 0.80\textwidth}{figs/banking-lost-update-depgraph-ww-tbta}
	\end{columns}

	\vspace{-0.20cm}
	\begin{center}
		\pause
		\fig{width = 0.50\textwidth}{figs/banking-lost-update-polygraph}
		polygraph:
		\pause
		% \vspace{-0.30cm}
		$\tuple{\teal{\eithervar} \triangleq \set{T_{A} \rel{\WW} T_{B}},
				\teal{\orvar} \triangleq \set{T_{B} \rel{\WW} T_{A}, T_{A}' \rel{\RW} T_{A}}}
		$
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\polysi: Pruning before Encoding}
	\begin{center}
		\fig{width = 0.90\textwidth}{figs/polysi-checker-pruning}

		\vspace{0.50cm}
		domain-specific pruning before encoding for efficiency
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\polysi: Pruning before Encoding (the $\WW$ case)}
	\begin{columns}
		\column{0.40\textwidth}
			\fig{width = 0.70\textwidth}{figs/pruning-ww-case}
		\column{0.60\textwidth}
		  \resizebox{1.00\textwidth}{!}{\input{tikz/banking-lost-update-polygraph-pruning-ww-tikz}}
	\end{columns}

	\vspace{0.30cm}
  \begin{center}
		\uncover<2->{
			$T_{A} \rel{\WW} T_{0}$ can be pruned due to the
			$T_{A} \rel{\WW} T_{0} \rel{\WR} T_{A}$ cycle.
		}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\polysi: Pruning before Encoding (the $\WW$ case)}
	\begin{columns}
		\column{0.40\textwidth}
			\fig{width = 0.60\textwidth}{figs/pruning-ww-case}
		\column{0.60\textwidth}
			\resizebox{1.00\textwidth}{!}{\input{tikz/banking-lost-update-polygraph-pruning-ww-tatb-tikz}}
	\end{columns}

	\vspace{0.30cm}
  \begin{center}
		\uncover<2->{
		$T_{A} \rel{\WW} T_{B}$ is pruned due to the $T_{A} \rel{\WW} T_{B} \rel{\RW} T_{A}$ cycle. \\[2pt]
		}
		\vspace{5pt}
		\uncover<3->{
		$T_{B} \rel{\WW} T_{A}$ is pruned due to the $T_{B} \rel{\WW} T_{A} \rel{\RW} T_{B}$ cycle. \\[8pt]
		}
		\vspace{10pt}
		\uncover<4->{
		\red{Therefore, we are sure that the history does {\it not} satisfy SI.}
		}
  \end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\polysi: Pruning before Encoding (the $\RW$ case)}
  \begin{center}
		\resizebox{0.30\textwidth}{!}{\input{tikz/pruning-rw-case-tikz}}
  \end{center}

	\uncover<2->{
		Check if there is a path from $\mathit{to}$ to any
		immediate predecessor $\mathit{prec}$ of $\mathit{from}$
		that does not contain $\RW$ edges.
	}
	% \uncover<3->{
  % \begin{theorem}[Theorem 4.1 of~\ncite{AnalysingSI:JACM2018}]
	% 	Informally, a history satisfies SI if only if \\[3pt]
	% 	\red{there exists} a dependency graph for it that contains \\[3pt]
	% 	only cycles (if any) with \blue{at least two adjacent $\RW$} edges.
	% \end{theorem}
	% }
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\textsc{PolySI}: An Illustrating Example of ``Long Fork''}
	\begin{center}
		\resizebox{0.90\textwidth}{!}{\input{tikz/polysi-alg-tikz}}

		\only<6>{
			% A ``long fork'' history with $\SO$ and $\WR$ edges.
			order between $T_{0}$, $T_{1}$, and $T_{5}$ (on $\keyxvar$)
			and between $T_{0}$ and $T_{2}$ (on $\keyyvar$)
		}

		\only<7>{
			The $T_{5} \rel{\WW(\keyxvar)} T_{0}$ case is pruned
			due to $T_{0} \rel{\SO} T_{5} \rel{\WW(\keyxvar)} T_{0}$.
		}

		\only<9>{
			The $T_{0} \rel{\WW(\keyxvar)} T_{5}$ case becomes known.
		}

		\only<11>{
			The $T_{1} \rel{\WW(\keyxvar)} T_{0}$ case is pruned
			due to $T_{3} \rel{\RW(\keyxvar)} T_{0} \rel{\WR(\keyyvar)} T_{3}$.
		}

		\only<13>{
			The $T_{0} \rel{\WW(\keyxvar)} T_{1}$ case becomes known.
		}

		\only<15>{
			The $T_{2} \rel{\WW(\keyyvar)} T_{0}$ case is pruned, \\
			while the $T_{0} \rel{\WW(\keyyvar)} T_{2}$ case becomes known.
		}
		\only<17>{
			The order between $T_{1}$ and $T_{5}$ is still uncertain after pruning.
		}
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\textsc{PolySI}: An Illustrating Example of ``Long Fork''}
	\vspace{-0.50cm}
	\[\tuple{
		\uncover<2->{\purple{\eithervar} = \set{T_{1} \rel{\WW(\keyxvar)} T_{5},
			T_{3} \rel{\RW(\keyxvar)} T_{5}}},
		\uncover<3->{\violet{\orvar} = \set{T_{5} \rel{\WW(\keyxvar)} T_{1}}}
	}\]

	\vspace{-0.30cm}
	\begin{center}
		\resizebox{0.80\textwidth}{!}{\input{tikz/polysi-alg-encoding-tikz}}
	\end{center}
	\vspace{-0.50cm}

	\uncover<4->{
		\[
			\purple{(\BV_{1,5} \land \BV_{3,5} \land \lnot \BV_{5,1})} \lor
			\violet{(\BV_{5,1} \land \lnot \BV_{1,5} \land \lnot \BV_{3,5})}
		\]
	}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\textsc{PolySI}: An Illustrating Example of ``Long Fork''}
	\vspace{-0.50cm}
	\uncover<2->{
	\[
		\purple{\boxed{((\SO_{\G} \cup \WR_{\G} \cup \WW_{\G}) \comp \RW_{\G}?)}} \text{\it\; is acyclic}.
	\]
	}

	\vspace{-0.40cm}
  \begin{columns}
		\column{0.50\textwidth}
			\fig{width = 1.00\textwidth}{figs/polysi-alg-final}
		\column{0.50\textwidth}
			\fig{width = 1.00\textwidth}{figs/polysi-alg-encoding}
	\end{columns}

	\uncover<3->{
	\begin{center}
		We need to encode the \purple{``composition ($\comp$)''} of dependency edges.
	\end{center}
	}

	\uncover<4->{
	\[
		T_{1} \rel{\WR} T_{3} \rel{\RW} T_{2}:\;
		  \BV_{1,2}^{\red{I}} = \BV_{1,3} \land \BV_{3,2} \quad
			(\red{I}\; \text{for the induced graph})
	\]
	}
	\vspace{-0.30cm}
	\uncover<5->{
	\[
		T_{1} \rel{\WR} T_{3} \rel{\RW} T_{5}:\;
		  \BV_{1,5}^{\red{I}} = \BV_{1,3} \land \BV_{3,5} \quad
			(\red{I}\; \text{for the induced graph})
	\]
	}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\textsc{PolySI}: An Illustrating Example of ``Long Fork''}
	\begin{center}
		Feed the SAT formula into the \blue{MonoSAT} solver~\ncite{MonoSAT:AAAI2015}
		optimized for \purple{\it cycle detection}

		\vspace{0.20cm}
		\fig{width = 0.40\textwidth}{figs/sat-solver}
		\vspace{0.20cm}

		Assert that the induced graph $\red{I}$ is acyclic.
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%
\begin{frame}{\textsc{PolySI}: An Illustrating Example of ``Long Fork''}
	\begin{center}
		\fig{width = 0.50\textwidth}{figs/polysi-alg-cycle}

		\vspace{0.20cm}
		The undesired cycle for ``long fork'' found by MonoSAT.
	\end{center}
\end{frame}
%%%%%%%%%%%%%%%%%%%%